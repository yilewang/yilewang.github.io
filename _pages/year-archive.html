---
layout: archive
permalink: /year-archive/
title: "Blog posts"
author_profile: true
redirect_from:
  - /wordpress/blog-posts/
---

{% include base_path %}

<div style="margin-bottom: 2em;">
  <h3>Filter by Tags</h3>
  <p id="tag-filters">
    {% assign all_tags = site.posts | map: 'tags' | flatten | uniq | sort %}
    {% for tag in all_tags %}
      <button class="btn btn--primary tag-filter-btn" data-tag="{{ tag | slugify }}" style="margin: 0.25em;">{{ tag }}</button>
    {% endfor %}
    <button class="btn btn--primary tag-filter-btn" id="clear-filters" style="margin: 0.25em;">Clear All</button>
  </p>
  <p id="active-filters" style="margin-top: 1em; font-style: italic; color: #666;"></p>
</div>

<div id="posts-container">
{% capture written_year %}'None'{% endcapture %}
{% for post in site.posts %}
  {% capture year %}{{ post.date | date: '%Y' }}{% endcapture %}
  {% if year != written_year %}
    <h2 id="{{ year | slugify }}" class="archive__subtitle year-header" data-year="{{ year }}">{{ year }}</h2>
    {% capture written_year %}{{ year }}{% endcapture %}
  {% endif %}
  <div class="post-item" data-tags="{% for tag in post.tags %}{{ tag | slugify }} {% endfor %}">
    {% include archive-single.html %}
  </div>
{% endfor %}
</div>

<script>
(function() {
  const tagButtons = document.querySelectorAll('.tag-filter-btn');
  const clearButton = document.getElementById('clear-filters');
  const activeFiltersEl = document.getElementById('active-filters');
  const postItems = document.querySelectorAll('.post-item');
  const yearHeaders = document.querySelectorAll('.year-header');
  let selectedTags = new Set();

  function updateActiveFilters() {
    if (selectedTags.size === 0) {
      activeFiltersEl.textContent = '';
    } else {
      activeFiltersEl.textContent = 'Active filters: ' + Array.from(selectedTags).join(', ');
    }
  }

  function filterPosts() {
    let visibleCount = 0;
    
    postItems.forEach(post => {
      const postTags = post.getAttribute('data-tags').trim().split(/\s+/);
      const hasAllTags = Array.from(selectedTags).every(tag => postTags.includes(tag));
      
      if (selectedTags.size === 0 || hasAllTags) {
        post.style.display = '';
        visibleCount++;
      } else {
        post.style.display = 'none';
      }
    });

    // Hide year headers if no posts are visible in that year
    yearHeaders.forEach(header => {
      const year = header.getAttribute('data-year');
      const yearPosts = Array.from(postItems).filter(post => {
        const postYear = post.previousElementSibling;
        return postYear && postYear.classList.contains('year-header') && 
               postYear.getAttribute('data-year') === year &&
               post.style.display !== 'none';
      });
      
      if (yearPosts.length === 0 && selectedTags.size > 0) {
        header.style.display = 'none';
      } else {
        header.style.display = '';
      }
    });
  }

  tagButtons.forEach(btn => {
    if (btn.id !== 'clear-filters') {
      btn.addEventListener('click', function() {
        const tag = this.getAttribute('data-tag');
        
        if (selectedTags.has(tag)) {
          selectedTags.delete(tag);
          this.classList.remove('active');
        } else {
          selectedTags.add(tag);
          this.classList.add('active');
        }
        
        updateActiveFilters();
        filterPosts();
      });
    }
  });

  clearButton.addEventListener('click', function() {
    selectedTags.clear();
    tagButtons.forEach(btn => btn.classList.remove('active'));
    updateActiveFilters();
    filterPosts();
  });
})();
</script>

<style>
.tag-filter-btn.active {
  background-color: #2e7d32;
  border-color: #2e7d32;
}
</style>
